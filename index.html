<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Mines Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gold: #FFD700;
            --primary-dark: #0a1628;
            --secondary-dark: #1a2f4d;
            --accent-blue: #4a90e2;
            --success-green: #22c55e;
            --danger-red: #ef4444;
            --warning-orange: #f59e0b;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1a3a5c 100%);
            min-height: 100vh;
            color: white;
        }

        /* Auth Screen */
        .auth-screen {
            display: none;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .auth-screen.active {
            display: flex;
        }

        .auth-box {
            background: linear-gradient(135deg, #1a3a5c 0%, #0f2847 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 450px;
            width: 100%;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-logo i {
            font-size: 60px;
            color: var(--primary-gold);
            margin-bottom: 15px;
        }

        .auth-logo h1 {
            font-size: 32px;
            color: var(--primary-gold);
            margin-bottom: 5px;
        }

        .auth-logo p {
            color: #7c9bb8;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #a0b4cc;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 15px;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-gold);
            background: rgba(255, 255, 255, 0.08);
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-gold) 0%, #ffed4e 100%);
            border: none;
            border-radius: 10px;
            color: var(--primary-dark);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
        }

        .auth-btn:active {
            transform: scale(0.98);
        }

        .create-admin-link {
            text-align: center;
            margin-top: 20px;
            color: #7c9bb8;
        }

        .create-admin-link a {
            color: var(--primary-gold);
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
        }

        /* Main Layout */
        .admin-container {
            display: none;
        }

        .admin-container.active {
            display: block;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a3a5c 0%, #0f2847 100%);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-btn {
            background: rgba(255, 215, 0, 0.1);
            border: none;
            color: var(--primary-gold);
            font-size: 22px;
            width: 45px;
            height: 45px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-gold);
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .logout-btn {
            background: linear-gradient(135deg, var(--danger-red) 0%, #dc2626 100%);
            padding: 10px 16px;
            border-radius: 10px;
            border: none;
            color: white;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Drawer */
        .drawer-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 998;
        }

        .drawer-overlay.active {
            display: block;
        }

        .drawer {
            position: fixed;
            left: -320px;
            top: 0;
            width: 300px;
            height: 100%;
            background: linear-gradient(135deg, #1a3a5c 0%, #0f2847 100%);
            transition: all 0.3s;
            z-index: 999;
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        .drawer.active {
            left: 0;
        }

        .drawer-header {
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
        }

        .drawer-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-gold);
        }

        .close-drawer {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .drawer-menu {
            padding: 20px 0;
        }

        .drawer-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            font-weight: 600;
        }

        .drawer-item:hover, .drawer-item.active {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid var(--primary-gold);
        }

        .drawer-item i {
            font-size: 20px;
            color: var(--primary-gold);
            width: 25px;
        }

        /* Dashboard */
        .content-area {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-icon {
            font-size: 50px;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 15px;
        }

        .stat-info h3 {
            font-size: 14px;
            color: #7c9bb8;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-info p {
            font-size: 28px;
            font-weight: 900;
            color: var(--primary-gold);
        }

        /* Table */
        .data-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-header {
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
        }

        .table-header h2 {
            font-size: 22px;
            color: var(--primary-gold);
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(255, 215, 0, 0.1);
            color: var(--primary-gold);
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .action-btns {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-view {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #3b82f6 100%);
            color: white;
        }

        .btn-edit {
            background: linear-gradient(135deg, var(--warning-orange) 0%, #d97706 100%);
            color: white;
        }

        .btn-delete {
            background: linear-gradient(135deg, var(--danger-red) 0%, #dc2626 100%);
            color: white;
        }

        .btn-accept {
            background: linear-gradient(135deg, var(--success-green) 0%, #16a34a 100%);
            color: white;
        }

        .btn-reject {
            background: linear-gradient(135deg, var(--danger-red) 0%, #dc2626 100%);
            color: white;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning-orange);
        }

        .status-approved {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success-green);
        }

        .status-rejected {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-red);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a3a5c 0%, #0f2847 100%);
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            border: 2px solid rgba(255, 215, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
        }

        .modal-title {
            font-size: 24px;
            color: var(--primary-gold);
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            color: #7c9bb8;
            font-weight: 600;
        }

        .info-value {
            color: white;
            font-weight: 700;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Game Controller */
        .multiplier-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .multiplier-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            text-align: center;
        }

        .multiplier-label {
            color: #7c9bb8;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .multiplier-value {
            font-size: 20px;
            font-weight: 900;
            color: var(--primary-gold);
            margin-bottom: 10px;
        }

        .multiplier-actions {
            display: flex;
            gap: 5px;
        }

        .multiplier-actions input {
            flex: 1;
            padding: 6px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            text-align: center;
            font-size: 13px;
        }

        .multiplier-actions button {
            padding: 6px 10px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
        }

        /* Promo Code Generator */
        .promo-form {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            margin-bottom: 20px;
        }

        .form-row {
            margin-bottom: 18px;
        }

        .form-row label {
            display: block;
            margin-bottom: 8px;
            color: #a0b4cc;
            font-weight: 600;
        }

        .form-row input, .form-row select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 15px;
        }

        .form-row input:focus, .form-row select:focus {
            outline: none;
            border-color: var(--primary-gold);
        }

        .generate-btn-group {
            display: flex;
            gap: 10px;
        }

        .generate-btn-group button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-weight: 700;
            cursor: pointer;
        }

        /* Promo List */
        .promo-list {
            display: grid;
            gap: 15px;
        }

        .promo-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary-gold);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .promo-code {
            font-size: 24px;
            font-weight: 900;
            color: var(--primary-gold);
            margin-bottom: 5px;
        }

        .promo-details {
            color: #7c9bb8;
            font-size: 13px;
        }

        /* Settings */
        .settings-grid {
            display: grid;
            gap: 20px;
        }

        .setting-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .setting-label {
            color: #a0b4cc;
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }

        .setting-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 15px;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--primary-gold);
        }

        .save-settings-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--success-green) 0%, #16a34a 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success-green) 0%, #16a34a 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            display: none;
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger-red) 0%, #dc2626 100%);
        }

        .notification.active {
            display: block;
            animation: slideInRight 0.4s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7c9bb8;
        }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 22px;
            margin-bottom: 10px;
        }

        /* Copy Button */
        .copy-btn {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #3b82f6 100%);
            padding: 8px 14px;
            border-radius: 8px;
            border: none;
            color: white;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .table-container {
                font-size: 13px;
            }

            th, td {
                padding: 10px;
            }

            .action-btns {
                flex-direction: column;
            }

            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="auth-screen active" id="loginScreen">
        <div class="auth-box">
            <div class="auth-logo">
                <i class="fas fa-user-shield"></i>
                <h1>Admin Panel</h1>
                <p>Mines Game Management</p>
            </div>

            <div class="input-group">
                <label><i class="fas fa-envelope"></i> Email</label>
                <input type="email" id="adminEmail" placeholder="admin@example.com">
            </div>

            <div class="input-group">
                <label><i class="fas fa-lock"></i> Password</label>
                <input type="password" id="adminPassword" placeholder="Enter password">
            </div>

            <button class="auth-btn" onclick="loginAdmin()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>

            <div class="create-admin-link">
                <a onclick="showCreateAdmin()">Create First Admin Account</a>
            </div>
        </div>
    </div>

    <!-- Create Admin Screen -->
    <div class="auth-screen" id="createAdminScreen">
        <div class="auth-box">
            <div class="auth-logo">
                <i class="fas fa-user-plus"></i>
                <h1>Create Admin</h1>
                <p>First Time Setup</p>
            </div>

            <div class="input-group">
                <label><i class="fas fa-user"></i> Admin Name</label>
                <input type="text" id="newAdminName" placeholder="Your name">
            </div>

            <div class="input-group">
                <label><i class="fas fa-envelope"></i> Email</label>
                <input type="email" id="newAdminEmail" placeholder="admin@example.com">
            </div>

            <div class="input-group">
                <label><i class="fas fa-lock"></i> Password</label>
                <input type="password" id="newAdminPassword" placeholder="Min 6 characters">
            </div>

            <button class="auth-btn" onclick="createAdmin()">
                <i class="fas fa-check"></i> Create Admin
            </button>

            <div class="create-admin-link">
                <a onclick="showLogin()">Back to Login</a>
            </div>
        </div>
    </div>

    <!-- Admin Container -->
    <div class="admin-container" id="adminContainer">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <button class="menu-btn" onclick="toggleDrawer()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="header-title" id="pageTitle">Dashboard</div>
            </div>
            <div class="header-right">
                <span id="adminNameDisplay" style="margin-right: 10px; color: #7c9bb8;"></span>
                <button class="logout-btn" onclick="logoutAdmin()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Drawer -->
        <div class="drawer-overlay" id="drawerOverlay" onclick="toggleDrawer()"></div>
        <div class="drawer" id="drawer">
            <div class="drawer-header">
                <div class="drawer-title">Menu</div>
                <button class="close-drawer" onclick="toggleDrawer()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="drawer-menu">
                <div class="drawer-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </div>
                <div class="drawer-item" onclick="showPage('gameController')">
                    <i class="fas fa-gamepad"></i>
                    <span>Game Controller</span>
                </div>
                <div class="drawer-item" onclick="showPage('userManagement')">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </div>
                <div class="drawer-item" onclick="showPage('depositRequests')">
                    <i class="fas fa-wallet"></i>
                    <span>Deposit Requests</span>
                </div>
                <div class="drawer-item" onclick="showPage('withdrawalRequests')">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Withdrawal Requests</span>
                </div>
                <div class="drawer-item" onclick="showPage('promoCodes')">
                    <i class="fas fa-tags"></i>
                    <span>Promo Codes</span>
                </div>
                <div class="drawer-item" onclick="showPage('settings')">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Page -->
            <div class="page-section active" id="dashboardPage">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <h3>Total Users</h3>
                            <p id="totalUsers">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéÆ</div>
                        <div class="stat-info">
                            <h3>Total Bets</h3>
                            <p id="totalBets">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <h3>Total Deposits</h3>
                            <p>‚Çπ<span id="totalDeposits">0</span></p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∏</div>
                        <div class="stat-info">
                            <h3>Total Withdrawals</h3>
                            <p>‚Çπ<span id="totalWithdrawals">0</span></p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-info">
                            <h3>Pending Deposits</h3>
                            <p id="pendingDeposits">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-info">
                            <h3>Pending Withdrawals</h3>
                            <p id="pendingWithdrawals">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-info">
                        <h3>Revenue</h3>
                        <p>‚Çπ<span id="totalRevenue">0</span></p>
                    </div>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h2><i class="fas fa-clock"></i> Recent Activities</h2>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Activity</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivitiesTable">
                            <tr>
                                <td colspan="5">
                                    <div class="empty-state">
                                        <i class="fas fa-inbox"></i>
                                        <h3>No Recent Activities</h3>
                                        <p>Activities will appear here</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Game Controller Page -->
        <div class="page-section" id="gameControllerPage">
            <div class="data-table">
                <div class="table-header">
                    <h2><i class="fas fa-bomb"></i> Multiplier Configuration</h2>
                    <p style="color: #7c9bb8; font-size: 14px; margin-top: 10px;">
                        Configure multipliers for each bomb count (1-24 bombs)
                    </p>
                </div>
                <div style="padding: 20px;">
                    <div class="form-row">
                        <label>Select Bomb Count</label>
                        <select id="bombCountSelect" onchange="loadMultipliers()">
                            <option value="1">1 Bomb</option>
                            <option value="2">2 Bombs</option>
                            <option value="3">3 Bombs</option>
                            <option value="4">4 Bombs</option>
                            <option value="5">5 Bombs</option>
                            <option value="6">6 Bombs</option>
                            <option value="7">7 Bombs</option>
                            <option value="8">8 Bombs</option>
                            <option value="9">9 Bombs</option>
                            <option value="10">10 Bombs</option>
                            <option value="11">11 Bombs</option>
                            <option value="12">12 Bombs</option>
                            <option value="13">13 Bombs</option>
                            <option value="14">14 Bombs</option>
                            <option value="15">15 Bombs</option>
                            <option value="16">16 Bombs</option>
                            <option value="17">17 Bombs</option>
                            <option value="18">18 Bombs</option>
                            <option value="19">19 Bombs</option>
                            <option value="20">20 Bombs</option>
                            <option value="21">21 Bombs</option>
                            <option value="22">22 Bombs</option>
                            <option value="23">23 Bombs</option>
                            <option value="24">24 Bombs</option>
                        </select>
                    </div>

                    <div class="multiplier-grid" id="multiplierGrid"></div>

                    <button class="save-settings-btn" onclick="saveMultipliers()">
                        <i class="fas fa-save"></i> Save Multipliers
                    </button>
                </div>
            </div>
        </div>

        <!-- User Management Page -->
        <div class="page-section" id="userManagementPage">
            <div class="data-table">
                <div class="table-header">
                    <h2><i class="fas fa-users"></i> All Users</h2>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Balance</th>
                                <th>Total Games</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr>
                                <td colspan="6">
                                    <div class="empty-state">
                                        <i class="fas fa-users"></i>
                                        <h3>No Users Found</h3>
                                        <p>Users will appear here</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Deposit Requests Page -->
        <div class="page-section" id="depositRequestsPage">
            <div class="data-table">
                <div class="table-header">
                    <h2><i class="fas fa-wallet"></i> Deposit Requests</h2>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>UTR Number</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="depositRequestsTable">
                            <tr>
                                <td colspan="7">
                                    <div class="empty-state">
                                        <i class="fas fa-wallet"></i>
                                        <h3>No Deposit Requests</h3>
                                        <p>Requests will appear here</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Withdrawal Requests Page -->
        <div class="page-section" id="withdrawalRequestsPage">
            <div class="data-table">
                <div class="table-header">
                    <h2><i class="fas fa-money-bill-wave"></i> Withdrawal Requests</h2>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Amount</th>
                                <th>Net Amount</th>
                                <th>Wallet Type</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalRequestsTable">
                            <tr>
                                <td colspan="8">
                                    <div class="empty-state">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <h3>No Withdrawal Requests</h3>
                                        <p>Requests will appear here</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Promo Codes Page -->
        <div class="page-section" id="promoCodesPage">
            <div class="promo-form">
                <h2 style="color: var(--primary-gold); margin-bottom: 20px;">
                    <i class="fas fa-plus-circle"></i> Create Promo Code
                </h2>

                <div class="form-row">
                    <label>Promo Code</label>
                    <input type="text" id="promoCodeInput" placeholder="Enter code or generate">
                </div>

                <div class="form-row">
                    <label>Amount (‚Çπ)</label>
                    <input type="number" id="promoAmountInput" placeholder="Enter amount" min="1">
                </div>

                <div class="form-row">
                    <label>Wallet Type</label>
                    <select id="promoWalletType">
                        <option value="bonus">Bonus Balance</option>
                        <option value="cash">Cash Balance</option>
                        <option value="winning">Winning Balance</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>Max Uses (0 = Unlimited)</label>
                    <input type="number" id="promoMaxUses" placeholder="0" min="0" value="1">
                </div>

                <div class="generate-btn-group">
                    <button onclick="generateRandomPromo()" style="background: linear-gradient(135deg, var(--accent-blue) 0%, #3b82f6 100%); color: white;">
                        <i class="fas fa-random"></i> Generate Random
                    </button>
                    <button onclick="createPromoCode()" style="background: linear-gradient(135deg, var(--success-green) 0%, #16a34a 100%); color: white;">
                        <i class="fas fa-check"></i> Create Promo
                    </button>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h2><i class="fas fa-tags"></i> Active Promo Codes</h2>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Amount</th>
                                <th>Wallet Type</th>
                                <th>Max Uses</th>
                                <th>Used</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="promoCodesTable">
                            <tr>
                                <td colspan="7">
                                    <div class="empty-state">
                                        <i class="fas fa-tags"></i>
                                        <h3>No Promo Codes</h3>
                                        <p>Create your first promo code</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div class="page-section" id="settingsPage">
            <div class="settings-grid">
                <div class="setting-card">
                    <label class="setting-label">
                        <i class="fas fa-gift"></i> Signup Bonus (‚Çπ)
                    </label>
                    <input type="number" class="setting-input" id="signupBonusInput" placeholder="Enter amount" min="0">
                </div>

                <div class="setting-card">
                    <label class="setting-label">
                        <i class="fas fa-arrow-down"></i> Minimum Deposit (‚Çπ)
                    </label>
                    <input type="number" class="setting-input" id="minDepositInput" placeholder="Enter amount" min="1">
                </div>

                <div class="setting-card">
                    <label class="setting-label">
                        <i class="fas fa-arrow-up"></i> Minimum Withdrawal (‚Çπ)
                    </label>
                    <input type="number" class="setting-input" id="minWithdrawalInput" placeholder="Enter amount" min="1">
                </div>

                <div class="setting-card">
                    <label class="setting-label">
                        <i class="fas fa-percent"></i> Withdrawal Commission (%)
                    </label>
                    <input type="number" class="setting-input" id="withdrawalCommissionInput" placeholder="Enter percentage" min="0" max="100" step="0.1">
                </div>

                <div class="setting-card">
                    <label class="setting-label">
                        <i class="fas fa-qrcode"></i> QR Code Image URL
                    </label>
                    <input type="text" class="setting-input" id="qrCodeUrlInput" placeholder="Enter image URL">
                </div>

                <div class="setting-card">
                    <label class="setting-label">
                        <i class="fas fa-phone"></i> UPI Number
                    </label>
                    <input type="text" class="setting-input" id="upiNumberInput" placeholder="Enter UPI number">
                </div>

                <div class="setting-card">
                    <label class="setting-label">
                        <i class="fas fa-envelope"></i> Support Email
                    </label>
                    <input type="email" class="setting-input" id="supportEmailInput" placeholder="support@example.com">
                </div>

                <div class="setting-card">
                    <label class="setting-label">
                        <i class="fas fa-phone-alt"></i> Support Phone
                    </label>
                    <input type="text" class="setting-input" id="supportPhoneInput" placeholder="+91 XXXXX XXXXX">
                </div>
            </div>

            <button class="save-settings-btn" onclick="saveSettings()">
                <i class="fas fa-save"></i> Save All Settings
            </button>
        </div>
    </div>
</div>

<!-- User View Modal -->
<div class="modal" id="userViewModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title"><i class="fas fa-user"></i> User Details</h2>
            <button class="close-modal" onclick="closeModal('userViewModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="userViewBody">
            <!-- User details will be loaded here -->
        </div>
    </div>
</div>

<!-- User Edit Modal -->
<div class="modal" id="userEditModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title"><i class="fas fa-edit"></i> Edit User</h2>
            <button class="close-modal" onclick="closeModal('userEditModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-row">
                <label>Username</label>
                <input type="text" id="editUsername" class="setting-input">
            </div>
            <div class="form-row">
                <label>Bonus Balance (‚Çπ)</label>
                <input type="number" id="editBonusBalance" class="setting-input">
            </div>
            <div class="form-row">
                <label>Cash Balance (‚Çπ)</label>
                <input type="number" id="editCashBalance" class="setting-input">
            </div>
            <div class="form-row">
                <label>Winning Balance (‚Çπ)</label>
                <input type="number" id="editWinningBalance" class="setting-input">
            </div>
            <div class="form-row">
                <label>Account Status</label>
                <select id="editUserStatus" class="setting-input">
                    <option value="active">Active</option>
                    <option value="blocked">Blocked</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn btn-accept" onclick="saveUserEdit()">
                <i class="fas fa-save"></i> Save Changes
            </button>
            <button class="modal-btn btn-delete" onclick="closeModal('userEditModal')">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>
</div>

<!-- Withdrawal View Modal -->
<div class="modal" id="withdrawalViewModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title"><i class="fas fa-money-bill-wave"></i> Withdrawal Details</h2>
            <button class="close-modal" onclick="closeModal('withdrawalViewModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="withdrawalViewBody">
            <!-- Withdrawal details will be loaded here -->
        </div>
    </div>
</div>

<!-- Deposit Reject Modal -->
<div class="modal" id="depositRejectModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title"><i class="fas fa-times-circle"></i> Reject Deposit</h2>
            <button class="close-modal" onclick="closeModal('depositRejectModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-row">
                <label>Rejection Reason</label>
                <textarea id="depositRejectReason" class="setting-input" rows="4" placeholder="Enter reason for rejection" style="resize: vertical;"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn btn-delete" onclick="confirmDepositRejection()">
                <i class="fas fa-times"></i> Confirm Reject
            </button>
            <button class="modal-btn" onclick="closeModal('depositRejectModal')" style="background: #374151; color: white;">
                <i class="fas fa-arrow-left"></i> Cancel
            </button>
        </div>
    </div>
</div>

<!-- Withdrawal Reject Modal -->
<div class="modal" id="withdrawalRejectModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title"><i class="fas fa-times-circle"></i> Reject Withdrawal</h2>
            <button class="close-modal" onclick="closeModal('withdrawalRejectModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-row">
                <label>Rejection Reason</label>
                <textarea id="withdrawalRejectReason" class="setting-input" rows="4" placeholder="Enter reason for rejection" style="resize: vertical;"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn btn-delete" onclick="confirmWithdrawalRejection()">
                <i class="fas fa-times"></i> Confirm Reject
            </button>
            <button class="modal-btn" onclick="closeModal('withdrawalRejectModal')" style="background: #374151; color: white;">
                <i class="fas fa-arrow-left"></i> Cancel
            </button>
        </div>
    </div>
</div>

<!-- Notification -->
<div class="notification" id="notification">
    <span id="notificationText">Success!</span>
</div>

<script>
   // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyD-iIn-rsQZLsIky8eSWwpu8WwT9na1iks",
  authDomain: "tast-1e3d6.firebaseapp.com",
  databaseURL: "https://tast-1e3d6-default-rtdb.firebaseio.com",
  projectId: "tast-1e3d6",
  storageBucket: "tast-1e3d6.firebasestorage.app",
  messagingSenderId: "150826320440",
  appId: "1:150826320440:web:3680ba177d2890f3571ccd",
  measurementId: "G-KYH4ZR17TQ"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentAdmin = null;
    let currentEditUserId = null;
    let currentDepositRequest = null;
    let currentWithdrawalRequest = null;
    let multiplierConfig = {};

    // Default Multiplier Configuration
    const defaultMultiplierConfig = {
        1: [1.04, 1.08, 1.13, 1.19, 1.25, 1.31, 1.38, 1.47, 1.56, 1.66, 1.78, 1.92, 2.08, 2.27, 2.5, 2.77, 3.15, 3.57, 4.16, 5.21, 6.25, 8.31, 12.5, 23.39],
        2: [1.08, 1.18, 1.29, 1.42, 1.57, 1.75, 1.96, 2.20, 2.49, 2.8, 3.25, 3.75, 4.36, 5.12, 5.98, 6.30, 7.49, 8.23, 9.28, 10.49, 13.00, 17.00, 28.00],
        3: [1.13, 1.29, 1.48, 1.69, 1.93, 2.21, 2.5, 2.93, 3.38, 3.91, 4.61, 5.41, 6.39, 7.58, 9.04, 10.86, 13.15, 16.04, 19.74, 23.52, 28.75, 35.00],
        4: [1.19, 1.42, 1.72, 2.11, 2.61, 3.26, 4.02, 5.15, 6.40, 8.26, 11.63, 13.69, 16.55, 19.31, 24.26, 30.39, 36.71, 45.05, 53.33, 61.00, 70.00],
        5: [1.25, 1.57, 1.99, 2.53, 3.24, 4.17, 5.40, 7.02, 9.18, 12.07, 15.97, 21.23, 28.39, 38.17, 51.62, 70.18, 95.86, 131.64, 181.54, 251.51],
        6: [1.31, 1.75, 2.35, 3.16, 4.28, 5.83, 7.99, 11.03, 15.32, 21.41, 30.10, 42.61, 60.73, 87.19, 125.89, 182.87, 267.35, 392.79, 579.76],
        7: [1.38, 1.96, 2.80, 4.02, 5.81, 8.46, 12.42, 18.40, 27.47, 41.31, 62.52, 95.35, 146.32, 225.88, 350.79, 547.74, 858.86, 1351.59],
        8: [1.47, 2.20, 3.31, 5.02, 7.66, 11.77, 18.20, 28.32, 44.30, 69.65, 110.08, 174.79, 278.87, 446.88, 718.60, 1158.98, 1874.47],
        9: [1.56, 2.49, 3.99, 6.43, 10.43, 17.01, 27.90, 46.00, 76.18, 126.72, 211.59, 354.83, 597.42, 1009.49, 1710.61, 2906.03],
        10: [1.66, 2.80, 4.76, 8.13, 13.96, 24.10, 41.88, 73.20, 128.54, 226.95, 402.47, 716.45, 1279.62, 2291.31, 4114.36],
        11: [1.78, 3.25, 5.95, 10.98, 20.38, 38.04, 71.32, 134.48, 254.91, 485.84, 929.11, 1785.33, 3442.17, 6648.19],
        12: [1.92, 3.75, 7.41, 14.72, 29.44, 59.23, 119.71, 243.13, 495.41, 1012.84, 2076.82, 4270.51, 8800.05],
        13: [2.08, 4.36, 9.24, 19.68, 42.15, 90.60, 195.44, 422.94, 917.37, 1995.07, 4348.57, 9497.87],
        14: [2.27, 5.12, 11.66, 26.74, 61.53, 142.23, 330.18, 769.42, 1797.93, 4212.52, 9896.92],
        15: [2.5, 5.98, 14.52, 35.63, 87.84, 217.50, 540.36, 1346.90, 3367.26, 8433.14],
        16: [2.77, 6.30, 18.23, 53.07, 155.20, 455.34, 1339.56, 3948.74, 11666.80],
        17: [3.15, 7.49, 22.94, 70.72, 219.23, 682.35, 2130.32, 6665.49],
        18: [3.57, 8.23, 28.92, 102.45, 364.71, 1303.87, 4676.94],
        19: [4.16, 9.28, 36.45, 144.45, 574.60, 2290.99],
        20: [5.21, 10.49, 47.49, 216.75, 993.45],
        21: [6.25, 13.00, 62.40, 301.54],
        22: [8.31, 17.00, 85.00],
        23: [12.5, 28.00],
        24: [23.39]
    };

    // Auth Functions
    function showLogin() {
        document.getElementById('createAdminScreen').classList.remove('active');
        document.getElementById('loginScreen').classList.add('active');
    }

    function showCreateAdmin() {
        document.getElementById('loginScreen').classList.remove('active');
        document.getElementById('createAdminScreen').classList.add('active');
    }

    function createAdmin() {
        const name = document.getElementById('newAdminName').value.trim();
        const email = document.getElementById('newAdminEmail').value.trim();
        const password = document.getElementById('newAdminPassword').value;

        if (!name || name.length < 3) {
            showNotification('Name must be at least 3 characters', 'error');
            return;
        }

        if (!email || !email.includes('@')) {
            showNotification('Please enter a valid email', 'error');
            return;
        }

        if (!password || password.length < 6) {
            showNotification('Password must be at least 6 characters', 'error');
            return;
        }

        auth.createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                currentAdmin = userCredential.user;
                
                // Create admin record
                const adminData = {
                    name: name,
                    email: email,
                    role: 'admin',
                    createdAt: new Date().toISOString()
                };

                db.ref('admins/' + currentAdmin.uid).set(adminData)
                    .then(() => {
                        // Initialize default settings
                        const defaultSettings = {
                            signupBonus: 50,
                            minDeposit: 100,
                            minWithdrawal: 200,
                            withdrawalCommission: 2,
                            qrCodeUrl: 'https://i.ibb.co/BKfq8CZK/1000757382.png',
                            upiNumber: '6294296388',
                            supportEmail: 'support@minesgame.com',
                            supportPhone: '+91 62942 96388',
                            multiplierConfig: defaultMultiplierConfig
                        };

                        db.ref('settings').set(defaultSettings)
                            .then(() => {
                                showNotification('Admin account created successfully!', 'success');
                                setTimeout(() => {
                                    showAdminPanel();
                                }, 1000);
                            });
                    })
                    .catch((error) => {
                        showNotification('Failed to create admin record', 'error');
                    });
            })
            .catch((error) => {
                if (error.code === 'auth/email-already-in-use') {
                    showNotification('Email already in use', 'error');
                } else {
                    showNotification('Failed to create admin: ' + error.message, 'error');
                }
            });
    }

    function loginAdmin() {
        const email = document.getElementById('adminEmail').value.trim();
        const password = document.getElementById('adminPassword').value;

        if (!email || !password) {
            showNotification('Please fill all fields', 'error');
            return;
        }

        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                currentAdmin = userCredential.user;
                
                // Check if user is admin
                db.ref('admins/' + currentAdmin.uid).once('value')
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            showAdminPanel();
                        } else {
                            showNotification('You are not authorized as admin', 'error');
                            auth.signOut();
                        }
                    });
            })
            .catch((error) => {
                showNotification('Invalid credentials', 'error');
            });
    }

    function showAdminPanel() {
        document.getElementById('loginScreen').classList.remove('active');
        document.getElementById('createAdminScreen').classList.remove('active');
        document.getElementById('adminContainer').classList.add('active');
        
        // Load admin name
        db.ref('admins/' + currentAdmin.uid).once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    const adminData = snapshot.val();
                    document.getElementById('adminNameDisplay').textContent = adminData.name;
                }
            });

        loadDashboard();
        loadMultiplierConfig();
    }

    function logoutAdmin() {
        if (confirm('Are you sure you want to logout?')) {
            auth.signOut().then(() => {
                location.reload();
            });
        }
    }

    // Navigation Functions
    function toggleDrawer() {
        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('drawerOverlay');
        drawer.classList.toggle('active');
        overlay.classList.toggle('active');
    }

    function showPage(pageName) {
        // Hide all pages
        document.querySelectorAll('.page-section').forEach(page => {
            page.classList.remove('active');
        });

        // Remove active from all menu items
        document.querySelectorAll('.drawer-item').forEach(item => {
            item.classList.remove('active');
        });

        // Show selected page
        const pageMap = {
            'dashboard': 'dashboardPage',
            'gameController': 'gameControllerPage',
            'userManagement': 'userManagementPage',
            'depositRequests': 'depositRequestsPage',
            'withdrawalRequests': 'withdrawalRequestsPage',
            'promoCodes': 'promoCodesPage',
            'settings': 'settingsPage'
        };

        document.getElementById(pageMap[pageName]).classList.add('active');

        // Update page title
        const titleMap = {
            'dashboard': 'Dashboard',
            'gameController': 'Game Controller',
            'userManagement': 'User Management',
            'depositRequests': 'Deposit Requests',
            'withdrawalRequests': 'Withdrawal Requests',
            'promoCodes': 'Promo Codes',
            'settings': 'Settings'
        };

        document.getElementById('pageTitle').textContent = titleMap[pageName];

        // Add active to clicked menu item
        event.target.closest('.drawer-item').classList.add('active');

        // Close drawer on mobile
        toggleDrawer();

        // Load data for specific pages
        if (pageName === 'dashboard') {
            loadDashboard();
        } else if (pageName === 'gameController') {
            loadMultipliers();
        } else if (pageName === 'userManagement') {
            loadUsers();
        } else if (pageName === 'depositRequests') {
            loadDepositRequests();
        } else if (pageName === 'withdrawalRequests') {
            loadWithdrawalRequests();
        } else if (pageName === 'promoCodes') {
            loadPromoCodes();
        } else if (pageName === 'settings') {
            loadSettings();
        }
    }

    // Dashboard Functions
    function loadDashboard() {
        // Load total users
        db.ref('users').once('value')
            .then((snapshot) => {
                const usersCount = snapshot.numChildren();
                document.getElementById('totalUsers').textContent = usersCount;

                let totalBets = 0;
                snapshot.forEach((child) => {
                    const userData = child.val();
                    if (userData.totalGames) {
                        totalBets += userData.totalGames;
                    }
                });
                document.getElementById('totalBets').textContent = totalBets;
            });

        // Load deposit stats
        let totalDepositsAmount = 0;
        let pendingDepositsCount = 0;
        
        db.ref('depositRequests').once('value')
            .then((snapshot) => {
                snapshot.forEach((userSnapshot) => {
                    userSnapshot.forEach((depositSnapshot) => {
                        const deposit = depositSnapshot.val();
                        if (deposit.status === 'approved') {
                            totalDepositsAmount += deposit.amount;
                        }
                        if (deposit.status === 'pending') {
                            pendingDepositsCount++;
                        }
                    });
                });
                
                document.getElementById('totalDeposits').textContent = totalDepositsAmount;
                document.getElementById('pendingDeposits').textContent = pendingDepositsCount;
            });

        // Load withdrawal stats
        let totalWithdrawalsAmount = 0;
        let pendingWithdrawalsCount = 0;
        
        db.ref('withdrawRequests').once('value')
            .then((snapshot) => {
                snapshot.forEach((userSnapshot) => {
                    userSnapshot.forEach((withdrawSnapshot) => {
                        const withdraw = withdrawSnapshot.val();
                        if (withdraw.status === 'approved') {
                            totalWithdrawalsAmount += withdraw.netAmount;
                        }
                        if (withdraw.status === 'pending') {
                            pendingWithdrawalsCount++;
                        }
                    });
                });
                
                document.getElementById('totalWithdrawals').textContent = totalWithdrawalsAmount;
                document.getElementById('pendingWithdrawals').textContent = pendingWithdrawalsCount;
                
                // Calculate revenue (deposits - withdrawals)
                const revenue = totalDepositsAmount - totalWithdrawalsAmount;
                document.getElementById('totalRevenue').textContent = revenue;
            });

        // Load recent activities
        loadRecentActivities();
    }

    function loadRecentActivities() {
        const activities = [];

        // Get deposit requests
        db.ref('depositRequests').once('value')
            .then((snapshot) => {
                snapshot.forEach((userSnapshot) => {
                    userSnapshot.forEach((depositSnapshot) => {
                        const deposit = depositSnapshot.val();
                        activities.push({
                            type: 'Deposit',
                            user: deposit.username,
                            amount: deposit.amount,
                            status: deposit.status,
                            date: deposit.date,
                            timestamp: deposit.timestamp
                        });
                    });
                });

                // Get withdrawal requests
                return db.ref('withdrawRequests').once('value');
            })
            .then((snapshot) => {
                snapshot.forEach((userSnapshot) => {
                    userSnapshot.forEach((withdrawSnapshot) => {
                        const withdraw = withdrawSnapshot.val();
                        activities.push({
                            type: 'Withdrawal',
                            user: withdraw.username,
                            amount: withdraw.netAmount,
                            status: withdraw.status,
                            date: withdraw.date,
                            timestamp: withdraw.timestamp
                        });
                    });
                });

                // Sort by timestamp (newest first)
                activities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                // Display top 20 activities
                displayRecentActivities(activities.slice(0, 20));
            });
    }

    function displayRecentActivities(activities) {
        const table = document.getElementById('recentActivitiesTable');
        
        if (activities.length === 0) {
            table.innerHTML = `
                <tr>
                    <td colspan="5">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <h3>No Recent Activities</h3>
                            <p>Activities will appear here</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        let html = '';
        activities.forEach(activity => {
            html += `
                <tr>
                    <td>${activity.user}</td>
                    <td><i class="fas fa-${activity.type === 'Deposit' ? 'wallet' : 'money-bill-wave'}"></i> ${activity.type}</td>
                    <td>‚Çπ${activity.amount}</td>
                    <td>${activity.date}</td>
                    <td><span class="status-badge status-${activity.status}">${activity.status.toUpperCase()}</span></td>
                </tr>
            `;
        });
        
        table.innerHTML = html;
    }

    // Game Controller Functions
    function loadMultiplierConfig() {
        db.ref('settings/multiplierConfig').once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    multiplierConfig = snapshot.val();
                } else {
                    multiplierConfig = defaultMultiplierConfig;
                }
            });
    }

    function loadMultipliers() {
        const bombCount = document.getElementById('bombCountSelect').value;
        const grid = document.getElementById('multiplierGrid');
        
        if (!multiplierConfig[bombCount]) {
            multiplierConfig[bombCount] = defaultMultiplierConfig[bombCount];
        }

        const multipliers = multiplierConfig[bombCount];
        let html = '';

        multipliers.forEach((mult, index) => {
            html += `
                <div class="multiplier-card">
                    <div class="multiplier-label">Coin ${index + 1}</div>
                    <div class="multiplier-value">${mult.toFixed(2)}x</div>
                    <div class="multiplier-actions">
                        <input type="number" step="0.01" value="${mult.toFixed(2)}" 
                               id="mult_${bombCount}_${index}" 
                               onchange="updateMultiplier(${bombCount}, ${index}, this.value)">
                        <button onclick="deleteMultiplier(${bombCount}, ${index})" 
                                style="background: var(--danger-red); color: white;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });

        grid.innerHTML = html;
    }

    function updateMultiplier(bombCount, index, value) {
        const newValue = parseFloat(value);
        if (isNaN(newValue) || newValue <= 0) {
            showNotification('Invalid multiplier value', 'error');
            return;
        }

        if (!multiplierConfig[bombCount]) {
            multiplierConfig[bombCount] = [...defaultMultiplierConfig[bombCount]];
        }

        multiplierConfig[bombCount][index] = newValue;
        showNotification('Multiplier updated (Click Save to apply)', 'success');
    }

    function deleteMultiplier(bombCount, index) {
        if (confirm('Are you sure you want to delete this multiplier?')) {
            if (!multiplierConfig[bombCount]) {
                multiplierConfig[bombCount] = [...defaultMultiplierConfig[bombCount]];
            }

            multiplierConfig[bombCount].splice(index, 1);
            loadMultipliers();
            showNotification('Multiplier deleted (Click Save to apply)', 'success');
        }
    }

    function saveMultipliers() {
        db.ref('settings/multiplierConfig').set(multiplierConfig)
            .then(() => {
                showNotification('Multipliers saved successfully!', 'success');
            })
            .catch((error) => {
                showNotification('Failed to save multipliers', 'error');
            });
    }

    // User Management Functions
    function loadUsers() {
        db.ref('users').once('value')
            .then((snapshot) => {
                const users = [];
                
                snapshot.forEach((child) => {
                    const userId = child.key;
                    const userData = child.val();
                    users.push({
                        id: userId,
                        username: userData.username,
                        email: userData.email,
                        balance: (userData.bonusBalance || 0) + (userData.cashBalance || 0) + (userData.winningBalance || 0),
                        bonusBalance: userData.bonusBalance || 0,
                        cashBalance: userData.cashBalance || 0,
                        winningBalance: userData.winningBalance || 0,
                        totalGames: userData.totalGames || 0,
                        status: userData.status || 'active'
                    });
                });

                displayUsers(users);
            });
    }

    function displayUsers(users) {
        const table = document.getElementById('usersTable');
        
        if (users.length === 0) {
            table.innerHTML = `
                <tr>
                    <td colspan="6">
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>No Users Found</h3>
                            <p>Users will appear here</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        let html = '';
        users.forEach(user => {
            html += `
                <tr>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>‚Çπ${user.balance.toFixed(2)}</td>
                    <td>${user.totalGames}</td>
                    <td><span class="status-badge status-${user.status === 'active' ? 'approved' : 'rejected'}">${user.status.toUpperCase()}</span></td>
                    <td>
                        <div class="action-btns">
                            <button class="btn btn-view" onclick="viewUser('${user.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-edit" onclick="editUser('${user.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-delete" onclick="deleteUser('${user.id}', '${user.username}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        table.innerHTML = html;
    }

    function viewUser(userId) {
        db.ref('users/' + userId).once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    const user = snapshot.val();
                    const totalBalance = (user.bonusBalance || 0) + (user.cashBalance || 0) + (user.winningBalance || 0);
                    
                    const html = `
                        <div class="info-row">
                            <span class="info-label">Username:</span>
                            <span class="info-value">${user.username}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Email:</span>
                            <span class="info-value">${user.email}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Bonus Balance:</span>
                            <span class="info-value">‚Çπ${(user.bonusBalance || 0).toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Cash Balance:</span>
                            <span class="info-value">‚Çπ${(user.cashBalance || 0).toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Winning Balance:</span>
                            <span class="info-value">‚Çπ${(user.winningBalance || 0).toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Balance:</span>
                            <span class="info-value">‚Çπ${totalBalance.toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Games:</span>
                            <span class="info-value">${user.totalGames || 0}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Wins:</span>
                            <span class="info-value">${user.totalWinsCount || 0}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Earnings:</span>
                            <span class="info-value">‚Çπ${(user.totalWins || 0).toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Losses:</span>
                            <span class="info-value">‚Çπ${(user.totalLosses || 0).toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value"><span class="status-badge status-${user.status === 'active' ? 'approved' : 'rejected'}">${(user.status || 'active').toUpperCase()}</span></span>
                        </div>
                    `;
                    
                    document.getElementById('userViewBody').innerHTML = html;
                    openModal('userViewModal');
                }
            });
    }

    function editUser(userId) {
        currentEditUserId = userId;
        
        db.ref('users/' + userId).once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    const user = snapshot.val();
                    
                    document.getElementById('editUsername').value = user.username;
                    document.getElementById('editBonusBalance').value = user.bonusBalance || 0;
                    document.getElementById('editCashBalance').value = user.cashBalance || 0;
                    document.getElementById('editWinningBalance').value = user.winningBalance || 0;
                    document.getElementById('editUserStatus').value = user.status || 'active';
                    
                    openModal('userEditModal');
                }
            });
    }

    function saveUserEdit() {
        if (!currentEditUserId) return;

        const username = document.getElementById('editUsername').value.trim();
        const bonusBalance = parseFloat(document.getElementById('editBonusBalance').value) || 0;
        const cashBalance = parseFloat(document.getElementById('editCashBalance').value) || 0;
        const winningBalance = parseFloat(document.getElementById('editWinningBalance').value) || 0;
        const status = document.getElementById('editUserStatus').value;

        if (!username) {
            showNotification('Username cannot be empty', 'error');
            return;
        }

        const updates = {
            username: username,
            bonusBalance: bonusBalance,
            cashBalance: cashBalance,
            winningBalance: winningBalance,
            balance: bonusBalance + cashBalance + winningBalance,
            status: status
        };

        db.ref('users/' + currentEditUserId).update(updates)
            .then(() => {
                showNotification('User updated successfully!', 'success');
                closeModal('userEditModal');
                loadUsers();
            })
            .catch((error) => {
                showNotification('Failed to update user', 'error');
            });
    }

    function deleteUser(userId, username) {
        if (confirm(`Are you sure you want to delete user "${username}"? This action cannot be undone!`)) {
            db.ref('users/' + userId).remove()
                .then(() => {
                    // Also delete user's deposit and withdrawal requests
                    db.ref('depositRequests/' + userId).remove();
                    db.ref('withdrawRequests/' + userId).remove();
                    
                    showNotification('User deleted successfully!', 'success');
                    loadUsers();
                })
                .catch((error) => {
                    showNotification('Failed to delete user', 'error');
                });
        }
    }

    // Deposit Request Functions
    function loadDepositRequests() {
        db.ref('depositRequests').once('value')
            .then((snapshot) => {
                const deposits = [];
                
                snapshot.forEach((userSnapshot) => {
                    const userId = userSnapshot.key;
                    
                    userSnapshot.forEach((depositSnapshot) => {
                        const depositId = depositSnapshot.key;
                        const deposit = depositSnapshot.val();
                        
                        deposits.push({
                            id: depositId,
                            userId: userId,
                            username: deposit.username,
                            email: deposit.email,
                            utrNumber: deposit.utrNumber,
                            amount: deposit.amount,
                            status: deposit.status,
                            date: deposit.date,
                            timestamp: deposit.timestamp
                        });
                    });
                });

                // Sort by timestamp (newest first)
                deposits.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                displayDepositRequests(deposits);
            });
    }

    function displayDepositRequests(deposits) {
        const table = document.getElementById('depositRequestsTable');
        
        if (deposits.length === 0) {
            table.innerHTML = `
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <i class="fas fa-wallet"></i>
                            <h3>No Deposit Requests</h3>
                            <p>Requests will appear here</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        let html = '';
        deposits.forEach(deposit => {
            html += `
                <tr>
                    <td>${deposit.username}</td>
                    <td>${deposit.email}</td>
                    <td>${deposit.utrNumber}</td>
                    <td>‚Çπ${deposit.amount}</td>
                    <td>${deposit.date}</td>
                    <td><span class="status-badge status-${deposit.status}">${deposit.status.toUpperCase()}</span></td>
                    <td>
                        ${deposit.status === 'pending' ? `
                            <div class="action-btns">
                                <button class="btn btn-accept" onclick="acceptDeposit('${deposit.userId}', '${deposit.id}', ${deposit.amount})">
                                    <i class="fas fa-check"></i> Accept
                                </button>
                                <button class="btn btn-reject" onclick="openDepositReject('${deposit.userId}', '${deposit.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        ` : '-'}
                    </td>
                </tr>
            `;
        });
        
        table.innerHTML = html;
    }

    function acceptDeposit(userId, depositId, amount) {
        if (confirm(`Accept deposit of ‚Çπ${amount}?`)) {
            // Update deposit status
            db.ref('depositRequests/' + userId + '/' + depositId).update({
                status: 'approved'
            })
            .then(() => {
                // Add amount to user's cash balance
                return db.ref('users/' + userId).once('value');
            })
            .then((snapshot) => {
                if (snapshot.exists()) {
                    const user = snapshot.val();
                    const newCashBalance = (user.cashBalance || 0) + amount;
                    const newTotalBalance = (user.bonusBalance || 0) + newCashBalance + (user.winningBalance || 0);
                    
                    return db.ref('users/' + userId).update({
                        cashBalance: newCashBalance,
                        balance: newTotalBalance
                    });
                }
            })
            .then(() => {
                showNotification('Deposit accepted successfully!', 'success');
                loadDepositRequests();
                loadDashboard();
            })
            .catch((error) => {
                showNotification('Failed to accept deposit', 'error');
            });
        }
    }

    function openDepositReject(userId, depositId) {
        currentDepositRequest = { userId, depositId };
        openModal('depositRejectModal');
    }

    function confirmDepositRejection() {
        if (!currentDepositRequest) return;

        const reason = document.getElementById('depositRejectReason').value.trim();
        
        if (!reason) {
            showNotification('Please enter rejection reason', 'error');
            return;
        }

        const { userId, depositId } = currentDepositRequest;

        db.ref('depositRequests/' + userId + '/' + depositId).update({
            status: 'rejected',
            rejectionReason: reason
        })
        .then(() => {
            showNotification('Deposit rejected successfully!', 'success');
            closeModal('depositRejectModal');
            document.getElementById('depositRejectReason').value = '';
            loadDepositRequests();
            loadDashboard();
        })
        .catch((error) => {
            showNotification('Failed to reject deposit', 'error');
        });
    }

    // Withdrawal Request Functions
    function loadWithdrawalRequests() {
        db.ref('withdrawRequests').once('value')
            .then((snapshot) => {
                const withdrawals = [];
                
                snapshot.forEach((userSnapshot) => {
                    const userId = userSnapshot.key;
                    
                    userSnapshot.forEach((withdrawSnapshot) => {
                        const withdrawId = withdrawSnapshot.key;
                        const withdraw = withdrawSnapshot.val();
                        
                        withdrawals.push({
                            id: withdrawId,
                            userId: userId,
                            username: withdraw.username,
                            email: withdraw.email,
                            upiId: withdraw.upiId,
                            amount: withdraw.amount,
                            netAmount: withdraw.netAmount,
                            processingFee: withdraw.processingFee,
                            walletType: withdraw.walletType,
                            status: withdraw.status,
                            date: withdraw.date,
                            timestamp: withdraw.timestamp
                        });
                    });
                });

                // Sort by timestamp (newest first)
                withdrawals.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                displayWithdrawalRequests(withdrawals);
            });
    }

    function displayWithdrawalRequests(withdrawals) {
        const table = document.getElementById('withdrawalRequestsTable');
        
        if (withdrawals.length === 0) {
            table.innerHTML = `
                <tr>
                    <td colspan="8">
                        <div class="empty-state">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3>No Withdrawal Requests</h3>
                            <p>Requests will appear here</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        let html = '';
        withdrawals.forEach(withdraw => {
            html += `
                <tr>
                    <td>${withdraw.username}</td>
                    <td>${withdraw.email}</td>
                    <td>‚Çπ${withdraw.amount}</td>
                    <td>‚Çπ${withdraw.netAmount}</td>
                    <td>${withdraw.walletType}</td>
                    <td>${withdraw.date}</td>
                    <td><span class="status-badge status-${withdraw.status}">${withdraw.status.toUpperCase()}</span></td>
                    <td>
                        ${withdraw.status === 'pending' ? `
                            <div class="action-btns">
                                <button class="btn btn-view" onclick="viewWithdrawal('${withdraw.userId}', '${withdraw.id}')">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn btn-accept" onclick="acceptWithdrawal('${withdraw.userId}', '${withdraw.id}')">
                                    <i class="fas fa-check"></i> Accept
                                </button>
                                <button class="btn btn-reject" onclick="openWithdrawalReject('${withdraw.userId}', '${withdraw.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        ` : '-'}
                    </td>
                </tr>
            `;
        });
        
        table.innerHTML = html;
    }

    function viewWithdrawal(userId, withdrawId) {
        db.ref('withdrawRequests/' + userId + '/' + withdrawId).once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    const withdraw = snapshot.val();
                    
                    const html = `
                        <div class="info-row">
                            <span class="info-label">Username:</span>
                            <span class="info-value">${withdraw.username}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Email:</span>
                            <span class="info-value">${withdraw.email}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">UPI ID:</span>
                            <span class="info-value">
                                ${withdraw.upiId}
                                <button class="copy-btn" onclick="copyToClipboard('${withdraw.upiId}')" style="margin-left: 10px;">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Amount:</span>
                            <span class="info-value">‚Çπ${withdraw.amount}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Processing Fee:</span>
                            <span class="info-value">‚Çπ${withdraw.processingFee}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Net Amount:</span>
                            <span class="info-value" style="color: var(--success-green);">‚Çπ${withdraw.netAmount}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Wallet Type:</span>
                            <span class="info-value">${withdraw.walletType}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value"><span class="status-badge status-${withdraw.status}">${withdraw.status.toUpperCase()}</span></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Date:</span>
                            <span class="info-value">${withdraw.date}</span>
                        </div>
                    `;
                    
                    document.getElementById('withdrawalViewBody').innerHTML = html;
                    openModal('withdrawalViewModal');
                }
            });
    }

    function acceptWithdrawal(userId, withdrawId) {
        if (confirm('Confirm that you have sent the payment?')) {
            db.ref('withdrawRequests/' + userId + '/' + withdrawId).update({
                status: 'approved'
            })
            .then(() => {
                showNotification('Withdrawal approved successfully!', 'success');
                loadWithdrawalRequests();
                loadDashboard();
            })
            .catch((error) => {
                showNotification('Failed to approve withdrawal', 'error');
            });
        }
    }

    function openWithdrawalReject(userId, withdrawId) {
        currentWithdrawalRequest = { userId, withdrawId };
        openModal('withdrawalRejectModal');
    }

    function confirmWithdrawalRejection() {
        if (!currentWithdrawalRequest) return;

        const reason = document.getElementById('withdrawalRejectReason').value.trim();
        
        if (!reason) {
            showNotification('Please enter rejection reason', 'error');
            return;
        }

        const { userId, withdrawId } = currentWithdrawalRequest;

        // First get the withdrawal details to refund
        db.ref('withdrawRequests/' + userId + '/' + withdrawId).once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    const withdraw = snapshot.val();
                    
                    // Update withdrawal status
                    return db.ref('withdrawRequests/' + userId + '/' + withdrawId).update({
                        status: 'rejected',
                        rejectionReason: reason
                    })
                    .then(() => {
                        // Refund amount to user's wallet
                        return db.ref('users/' + userId).once('value');
                    })
                    .then((userSnapshot) => {
                        if (userSnapshot.exists()) {
                            const user = userSnapshot.val();
                            
                            // Refund based on wallet type
                            let updates = {};
                            if (withdraw.walletType === 'cash') {
                                updates.cashBalance = (user.cashBalance || 0) + withdraw.amount;
                            } else if (withdraw.walletType === 'winning') {
                                updates.winningBalance = (user.winningBalance || 0) + withdraw.amount;
                            } else if (withdraw.walletType === 'all') {
                                updates.cashBalance = (user.cashBalance || 0) + withdraw.amount;
                            }
                            
                            updates.balance = (user.bonusBalance || 0) + (updates.cashBalance || user.cashBalance || 0) + (updates.winningBalance || user.winningBalance || 0);
                            
                            return db.ref('users/' + userId).update(updates);
                        }
                    });
                }
            })
            .then(() => {
                showNotification('Withdrawal rejected and amount refunded!', 'success');
                closeModal('withdrawalRejectModal');
                document.getElementById('withdrawalRejectReason').value = '';
                loadWithdrawalRequests();
                loadDashboard();
            })
            .catch((error) => {
                showNotification('Failed to reject withdrawal', 'error');
            });
    }

    // Promo Code Functions
    function generateRandomPromo() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = '';
        for (let i = 0; i < 8; i++) {
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        document.getElementById('promoCodeInput').value = code;
    }

    function createPromoCode() {
        const code = document.getElementById('promoCodeInput').value.trim().toUpperCase();
        const amount = parseFloat(document.getElementById('promoAmountInput').value);
        const walletType = document.getElementById('promoWalletType').value;
        const maxUses = parseInt(document.getElementById('promoMaxUses').value) || 0;

        if (!code) {
            showNotification('Please enter promo code', 'error');
            return;
        }

        if (code.length < 4) {
            showNotification('Promo code must be at least 4 characters', 'error');
            return;
        }

        if (!amount || amount < 1) {
            showNotification('Please enter valid amount', 'error');
            return;
        }

        // Check if promo code already exists
        db.ref('promoCodes/' + code).once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    showNotification('Promo code already exists', 'error');
                    return;
                }

                const promoData = {
                    code: code,
                    amount: amount,
                    walletType: walletType,
                    maxUses: maxUses,
                    usedCount: 0,
                    usedBy: {},
                    createdAt: new Date().toISOString(),
                    createdDate: new Date().toLocaleString(),
                    status: 'active'
                };

                return db.ref('promoCodes/' + code).set(promoData);
            })
            .then(() => {
                showNotification('Promo code created successfully!', 'success');
                document.getElementById('promoCodeInput').value = '';
                document.getElementById('promoAmountInput').value = '';
                document.getElementById('promoMaxUses').value = '1';
                loadPromoCodes();
            })
            .catch((error) => {
                showNotification('Failed to create promo code', 'error');
            });
    }

    function loadPromoCodes() {
        db.ref('promoCodes').once('value')
            .then((snapshot) => {
                const promos = [];
                
                snapshot.forEach((child) => {
                    const promo = child.val();
                    promos.push(promo);
                });

                // Sort by creation date (newest first)
                promos.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                displayPromoCodes(promos);
            });
    }

    function displayPromoCodes(promos) {
        const table = document.getElementById('promoCodesTable');
        
        if (promos.length === 0) {
            table.innerHTML = `
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <i class="fas fa-tags"></i>
                            <h3>No Promo Codes</h3>
                            <p>Create your first promo code</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        let html = '';
        promos.forEach(promo => {
            html += `
                <tr>
                    <td><strong style="color: var(--primary-gold); font-size: 16px;">${promo.code}</strong></td>
                    <td>‚Çπ${promo.amount}</td>
                    <td>${promo.walletType}</td>
                    <td>${promo.maxUses === 0 ? 'Unlimited' : promo.maxUses}</td>
                    <td>${promo.usedCount || 0}</td>
                    <td>${promo.createdDate}</td>
                    <td>
                        <button class="btn btn-delete" onclick="deletePromoCode('${promo.code}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>
            `;
        });
        
        table.innerHTML = html;
    }

    function deletePromoCode(code) {
        if (confirm(`Are you sure you want to delete promo code "${code}"?`)) {
            db.ref('promoCodes/' + code).remove()
                .then(() => {
                    showNotification('Promo code deleted successfully!', 'success');
                    loadPromoCodes();
                })
                .catch((error) => {
                    showNotification('Failed to delete promo code', 'error');
                });
        }
    }

    // Settings Functions
    function loadSettings() {
        db.ref('settings').once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    const settings = snapshot.val();
                    
                    document.getElementById('signupBonusInput').value = settings.signupBonus || 50;
                    document.getElementById('minDepositInput').value = settings.minDeposit || 100;
                    document.getElementById('minWithdrawalInput').value = settings.minWithdrawal || 200;
                    document.getElementById('withdrawalCommissionInput').value = settings.withdrawalCommission || 2;
                    document.getElementById('qrCodeUrlInput').value = settings.qrCodeUrl || '';
                    document.getElementById('upiNumberInput').value = settings.upiNumber || '';
                    document.getElementById('supportEmailInput').value = settings.supportEmail || '';
                    document.getElementById('supportPhoneInput').value = settings.supportPhone || '';
                }
            });
    }

    function saveSettings() {
        const signupBonus = parseFloat(document.getElementById('signupBonusInput').value) || 0;
        const minDeposit = parseFloat(document.getElementById('minDepositInput').value) || 100;
        const minWithdrawal = parseFloat(document.getElementById('minWithdrawalInput').value) || 200;
        const withdrawalCommission = parseFloat(document.getElementById('withdrawalCommissionInput').value) || 2;
        const qrCodeUrl = document.getElementById('qrCodeUrlInput').value.trim();
        const upiNumber = document.getElementById('upiNumberInput').value.trim();
        const supportEmail = document.getElementById('supportEmailInput').value.trim();
        const supportPhone = document.getElementById('supportPhoneInput').value.trim();

        if (minDeposit < 1) {
            showNotification('Minimum deposit must be at least ‚Çπ1', 'error');
            return;
        }

        if (minWithdrawal < 1) {
            showNotification('Minimum withdrawal must be at least ‚Çπ1', 'error');
            return;
        }

        if (withdrawalCommission < 0 || withdrawalCommission > 100) {
            showNotification('Commission must be between 0-100%', 'error');
            return;
        }

        const settings = {
            signupBonus: signupBonus,
            minDeposit: minDeposit,
            minWithdrawal: minWithdrawal,
            withdrawalCommission: withdrawalCommission,
            qrCodeUrl: qrCodeUrl,
            upiNumber: upiNumber,
            supportEmail: supportEmail,
            supportPhone: supportPhone
        };

        db.ref('settings').update(settings)
            .then(() => {
                showNotification('Settings saved successfully!', 'success');
            })
            .catch((error) => {
                showNotification('Failed to save settings', 'error');
            });
    }

    // Modal Functions
    function openModal(modalId) {
        document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }

    // Utility Functions
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        
        notificationText.textContent = message;
        notification.className = 'notification ' + type + ' active';
        
        setTimeout(() => {
            notification.classList.remove('active');
        }, 3000);
    }

    function copyToClipboard(text) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    showNotification('Copied to clipboard!', 'success');
                })
                .catch(() => {
                    fallbackCopyToClipboard(text);
                });
        } else {
            fallbackCopyToClipboard(text);
        }
    }

    function fallbackCopyToClipboard(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            showNotification('Copied to clipboard!', 'success');
        } catch (err) {
            showNotification('Failed to copy', 'error');
        }
        
        document.body.removeChild(textArea);
    }

    // Firebase Auth State Listener
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentAdmin = user;
            
            // Check if user is admin
            db.ref('admins/' + currentAdmin.uid).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        // Already logged in
                        if (document.getElementById('adminContainer').classList.contains('active')) {
                            return;
                        }
                        showAdminPanel();
                    } else {
                        // Not an admin
                        auth.signOut();
                        showLogin();
                    }
                })
                .catch(() => {
                    auth.signOut();
                    showLogin();
                });
        } else {
            // Not logged in
            document.getElementById('adminContainer').classList.remove('active');
            
            // Check if any admin exists
            db.ref('admins').once('value')
                .then((snapshot) => {
                    if (snapshot.numChildren() === 0) {
                        // No admin exists, show create admin screen
                        showCreateAdmin();
                    } else {
                        // Admin exists, show login screen
                        showLogin();
                    }
                });
        }
    });

    // Close modals when clicking outside
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });
    });

    // Prevent form submission on enter key
    document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
            e.preventDefault();
        }
    });

    // Auto-refresh data every 30 seconds
    setInterval(() => {
        if (currentAdmin && document.getElementById('adminContainer').classList.contains('active')) {
            const activePage = document.querySelector('.page-section.active');
            if (activePage) {
                const pageId = activePage.id;
                
                if (pageId === 'dashboardPage') {
                    loadDashboard();
                } else if (pageId === 'userManagementPage') {
                    loadUsers();
                } else if (pageId === 'depositRequestsPage') {
                    loadDepositRequests();
                } else if (pageId === 'withdrawalRequestsPage') {
                    loadWithdrawalRequests();
                } else if (pageId === 'promoCodesPage') {
                    loadPromoCodes();
                }
            }
        }
    }, 30000);

    console.log('Admin Panel Loaded - Mines Game');
</script>
</body>
</html><e